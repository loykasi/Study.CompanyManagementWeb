@model CompanyManagementWeb.ViewModels.ScheduleIndexViewModel
@inject CompanyManagementWeb.Services.IUserService userService

@{
    ViewData["Title"] = "Index";
}

<div class="d-flex justify-content-between my-3">
    <h2 class="m-0 align-bottom">Lịch trình</h2>
    @if (await userService.IsInPermission("Schedule", "Edit"))
    {
        <a class="m-0 align-bottom btn btn-secondary" asp-action="Create">Tạo lịch trình</a>
    }
</div>

<div class="card">
    <div class="card-body">
        <form id="searchForm" asp-action="Search" class="row">
            <div class="col-md-3 form-group mb-2">
                <label asp-for="DepartmentId" class="control-label mb-2">Phòng ban</label>
                <select asp-for="DepartmentId" class ="form-control">
                    <option value="">All</option>
                    @foreach (var item in Model.Departments)
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                </select>
            </div>
            <div class="col-md-3 form-group mb-2">
                <label asp-for="FromDate" class="control-label mb-2">Từ ngày</label>
                <input asp-for="FromDate" type="date" class="form-control" />
            </div>
            <div class="col-md-3 form-group mb-2">
                <label asp-for="ToDate" class="control-label mb-2">Đến ngày</label>
                <input asp-for="ToDate" type="date" class="form-control" />
            </div>
            <div class="form-group">
                <input type="submit" value="Tìm kiếm" class="btn btn-danger" />
            </div>
        </form>
    </div>
    <div class="card-footer">
        <button onclick="getCurrent()" class="btn btn-primary">Hiện tại</button>
        <button onclick="getOldSchedules()" class="btn btn-primary">Lịch trình cũ</button>
    </div>
</div>

<div id="scheduleList" class="row mt-3">
    <partial name="ScheduleListPartial" model="Model" />
</div>

@section Scripts {
    <script>
        $("#searchForm").submit(function(e) {
            e.preventDefault();

            var form = $(this);
            var actionUrl = form.attr('action');

            $.ajax({
                type: 'GET',
                url: actionUrl,
                data: form.serialize(),
                success: function (response) {
                    $('#scheduleList').html(response);
                },
                error: function (response, status, error) {
                    console.log(status);
                },
            });
        });

        function getOldSchedules() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetOldSchedules")',
                success: function (response) {
                    $('#scheduleList').html(response);
                },
                error: function (response, status, error) {
                    console.log(status);
                },
            });
        };
        function getCurrent() {
            $.ajax({
                type: 'GET',
                url: '@Url.Action("GetCurrent")',
                success: function (response) {
                    $('#scheduleList').html(response);
                },
                error: function (response, status, error) {
                    console.log(status);
                },
            });
        };
    </script>
}

@* <div class="row mt-3">
@foreach (var group in Model.Schedules.GroupBy(s => s.FormattedDate).OrderBy(s => s.Key))
{

    <div class="p-3 col-md-3 border-bottom @(group.Key == DateTime.Now.Date.ToString("dd/MM/yyyy")? "bg-light" : "")">
        <h4 class="">
            @group.Key @(group.Key == DateTime.Now.Date.ToString("dd/MM/yyyy")? "(Hôm nay)" : "")
        </h4>
        @foreach (var item in group)
        {
            <div class="card my-3">
                <div class="card-header">
                    <span>@item.FormattedStartTime - @item.FormattedEndTime</span>
                </div>
                <div class="card-body">
                    <h5 class="card-title">@item.Title</h5>
                    <div>@item.Description</div>
                    <div class="d-flex justify-content-between mt-4">
                        <span class=""><em>@item.DepartmentName</em></span>
                        <span class=""><em>@item.EmployeeName</em></span>
                    </div>
                </div>
                <div class="card-footer">
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary">Edit</a>
                </div>
            </div>
        }
    </div>
}
</div> *@
